{% extends 'Account/home_base.html' %}
{% load static %}
{%block title%}Requests{%endblock title%}

{% block content %}
{% load crispy_forms_tags %}
    {% if user.is_authenticated %}
        <a href="javascript:history.go(-1)" class="btn btn-outline-secondary">Back</a>
        <div class="container">
            {% for object in qs %}
                <div class="row" style="padding-bottom:2px">
                  <div class="col-md-2 col-sm-2">
                    <img src="{{ object.sender.image.url }}" alt="user" height="50px"
                         width="50px" style="border-radius:50%">
                  </div>
                  <div class="col-md-7 col-sm-7">
                    <h5><a href="{% url 'friend_detail' object.sender.id %}" class="profile-link">{{ object }}</a></h5>
                  </div>
                  <div class="col-md-3 col-sm-3">
                        {% csrf_token%}
                        <button type="button" class="btn btn-primary pull-right" id="accept-frnd"
                                value="{{ object.sender.id }}">Accept Friend Request</button>

                      <form action="{% url 'remove_request' %}" method="post">
                        {% csrf_token%}
                        <input type="hidden" name="profile_pk" value="{{ object.sender.id }}">
                        <button type="button" class="btn btn-primary pull-right" id="reject-frnd"
                                value="{{ object.sender.id }}">Remove
                            from Friend Request</button>
                      </form>
                  </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <small class="text-muted"><a href="{% url 'login' %}" class="ml-2">Login</a></small>
    {% endif %}








{% endblock content %}


{% block scripts%}
<script>
$(document).ready(function(){
window.onload = function() {
	if(!window.location.hash) {
		window.location = window.location;
		window.location.reload();
	}
};
$.ajaxSetup({
       headers: {
         "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
       }
   });
$("#accept-frnd").click(function() {
    var user = $(this).val()
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "{% url 'accept_request' %}",
      data: {
        'profile_pk': user,
        },
      success:  function () {
        location.reload();
        console.log('Success');
       },
    });
    return false;
  });
  $("#reject-frnd").click(function() {
    var user = $(this).val()
    console.log(user)
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "{% url 'remove_request' %}",
      data: {
        'profile_pk': user,
        },
      success:  function () {
        console.log('Success');
        location.reload();
       },
    });
    return false;
  });
});
</script>>
{% endblock scripts%}